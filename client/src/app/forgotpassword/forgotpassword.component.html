<!-- Fullscreen Centered Container -->
<div class="d-flex justify-content-center align-items-center vh-100 bg-light">
  <div class="card shadow-lg border-0 p-4" style="width: 100%; max-width: 400px;">
    <div class="card-body">
      <h3 class="text-center mb-4">Forgot Password</h3>

      <!-- Step 1: Send OTP -->
      <form [formGroup]="forgotForm" (ngSubmit)="sendOtp()">
        <div class="mb-3">
          <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
          <input
            type="email"
            id="email"
            formControlName="email"
            class="form-control"
            placeholder="Enter your email"
          />
        </div>

        <button
          type="submit"
          class="btn btn-primary w-100"
          [disabled]="forgotForm.invalid || loading"
        >
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status"></span>
          {{ loading ? 'Sending...' : 'Send OTP' }}
        </button>

        <div *ngIf="MailError" class="alert alert-danger mt-3 text-center">
          {{ MailError }}
        </div>
      </form>

      <!-- Step 2: Validate OTP -->
      <div *ngIf="otpSent" class="mt-4">
        <form [formGroup]="resetForm" autocomplete="off">
          <div class="mb-3">
            <label for="otp" class="form-label">OTP</label>
            <input
              type="text"
              id="otp"
              formControlName="otp"
              class="form-control"
              placeholder="Enter OTP"
            />
          </div>

          <button
            type="button"
            class="btn btn-warning w-100 mb-3"
            (click)="validateOtp()"
            [disabled]="resetForm.get('otp')?.invalid"
          >
            Validate OTP
          </button>

          <!-- Step 3: Reset Password (only if OTP validated) -->
          <div *ngIf="otpValidated">
            <div class="mb-3">
              <label for="newPassword" class="form-label fw-semibold">New Password <span class="text-danger">*</span></label>
              <input
                type="password"
                id="newPassword"
                formControlName="newPassword"
                class="form-control"
                placeholder="Enter new password"
              />
              <!-- Validation messages -->
              <div *ngIf="resetForm.get('newPassword')?.touched && resetForm.get('newPassword')?.invalid" class="text-danger small mt-1">
                <div *ngIf="resetForm.get('newPassword')?.errors?.['required']">Please enter password.</div>
                <div *ngIf="resetForm.get('newPassword')?.errors?.['pattern']">
                  Password must include an uppercase, lowercase, digit, and special character.
                </div>
              </div>
            </div>

            <button
              type="button"
              class="btn btn-success w-100"
              (click)="resetPassword()"
              [disabled]="resetForm.get('newPassword')?.invalid"
            >
              Reset Password
            </button>
          </div>
        </form>

        <div *ngIf="successMessage" class="alert alert-success mt-3 text-center">
          {{ successMessage }}
        </div>
        <div *ngIf="errorMessage" class="alert alert-danger mt-3 text-center">
          {{ errorMessage }}
        </div>
      </div>
    </div>
  </div>
</div>
