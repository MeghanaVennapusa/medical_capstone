<div class="maintenance-wrapper">
  <div class="glass-container mt-4 p-4 shadow-lg rounded-4">
    <h2 class="mb-4 text-center">Manage Maintenance</h2>

    <!-- Search Bar -->
    <div class="mb-4">
      <input
        type="text"
        class="form-control search-bar"
        placeholder="ðŸ” Search by Hospital Name"
        [(ngModel)]="searchTerm"
        (input)="filterMaintenance()" />
    </div>
    
    <!-- Table -->
    <div class="table-responsive">
      <table class="table table-bordered table-striped text-center align-middle shadow-sm">
        <thead class="table-dark">
          <tr>
            <th>Sr#</th>
            <th (click)="sortBy('scheduledDate')" style="cursor:pointer">
              Scheduled Date
              <span *ngIf="sortDirection['scheduledDate'] === 'asc'">&#9650;</span>
              <span *ngIf="sortDirection['scheduledDate'] === 'desc'">&#9660;</span>
            </th>
            <th (click)="sortBy('completedDate')" style="cursor:pointer">
              Completion Date
              <span *ngIf="sortDirection['completedDate'] === 'asc'">&#9650;</span>
              <span *ngIf="sortDirection['completedDate'] === 'desc'">&#9660;</span>
            </th>
            <th>Status</th>
            <th>Equipment</th>
            <th>Hospital</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngIf="paginatedMaintenance.length === 0">
            <td colspan="7" class="text-center py-3"  >No records found</td>
          </tr>

          <tr *ngFor="let maintenance of paginatedMaintenance; let i = index">
            <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
            <td>{{ maintenance.scheduledDate | date:'dd-MMM-yyyy' }}</td>
            <td>{{ maintenance.completedDate | date:'dd-MMM-yyyy' }}</td>

            <!-- Colored status badges -->
            <td>
              <span
                class="badge px-3 py-2"
                [ngClass]="{
                  'status-completed': maintenance.status === 'Completed',
                  'status-inprocess': maintenance.status === 'In Process',
                  'status-initiated': maintenance.status === 'Initiated'
                }">
                {{ maintenance.status }}
              </span>
            </td>

            <td>
              <strong class="text-accent">{{ maintenance.equipment?.name }}</strong><br />
              <small>Description: {{ maintenance.description }}</small>
            </td>

            <td>
              <strong>{{ maintenance.equipment?.hospital?.name }}</strong><br />
              <small>Location: {{ maintenance.equipment?.hospital?.location }}</small>
            </td>

            <td>
              <button class="btn btn-warning btn-sm px-3" (click)="edit(maintenance)">Edit</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="d-flex justify-content-center mt-4">
      <nav>
        <ul class="pagination">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="changePage(currentPage - 1)">Previous</button>
          </li>

          <li
            class="page-item"
            *ngFor="let page of [].constructor(totalPages); let p = index"
            [class.active]="currentPage === p + 1">
            <button class="page-link" (click)="changePage(p + 1)">{{ p + 1 }}</button>
          </li>

          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link" (click)="changePage(currentPage + 1)">Next</button>
          </li>
        </ul>
      </nav>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content glass-modal">
        <div class="modal-header">
          <h5 class="modal-title">Update Maintenance</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="itemForm" (ngSubmit)="update()">
            <div class="mb-3">
              <label>Scheduled Date</label>
              <input type="date" class="form-control not-allowed" formControlName="scheduledDate" />
            </div>

            <div class="mb-3">
              <label>Completed Date</label>
              <input
                type="date"
                class="form-control"
                formControlName="completedDate"
                [min]="maintenanceObj.scheduledDate?.split('T')[0]" />
            </div>

            <div class="mb-3">
              <label>Description</label>
              <input type="text" class="form-control" formControlName="description" />
              <div *ngIf="itemForm.get('description')?.errors?.['required']" class="text-danger small">
                Description is required.
              </div>
            </div>

            <div class="mb-3">
              <label>Status</label>
              <select class="form-control" formControlName="status">
                <option value="">Choose Status</option>
                <option value="Initiated">Initiated</option>
                <option value="In Process">In Process</option>
                <option value="Completed">Completed</option>
              </select>
              <div *ngIf="itemForm.get('status')?.errors?.['required']" class="text-danger small">
                Status is required.
              </div>
            </div>

            <button type="submit" class="btn btn-primary w-100" [disabled]="itemForm.invalid">
              Submit
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>